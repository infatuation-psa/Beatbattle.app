function onChange(){$(".tooltipped").tooltip(),$(".playButton").click(function(){var t=$(this);embed=t.data("embed"),t.closest(".embedded-track").html(embed)})}angular.module("BeatBattle",["ngMaterial","md.data.table"]).config(["$mdThemingProvider",function(t){"use strict";t.theme("default")}]).controller("BeatBattleController",["$mdEditDialog","$q","$scope","$timeout",function(t,e,a,n){"use strict";a.drawTable=!0,a.selected=[],a.limitOptions=[10,25,100],a.query={order:"name",limit:10,page:1},a.beats={count:battleEntries.length,data:battleEntries},a.toggleLimitOptions=function(){a.limitOptions=a.limitOptions?void 0:[10,25,100]},a.editPlacement=function(e,i){e.stopPropagation(),t.small({modelValue:i.placement,save:function(t){i.placement=parseInt(t.$modelValue),$.ajax({url:"/placement",data:"battleID="+i.battle_id+"&beatID="+i.id+"&placement="+i.placement,type:"post",success:function(t){t.Redirect?window.location.replace(t.RedirectPath):M.toast({html:t.ToastHTML,classes:t.ToastClass,displayLength:1500}),"placement"==t.ToastQuery&&function(t){var e=JSON.parse(JSON.stringify(a.beats.data));e.splice(t.index,1),e.sort(function(t,e){return t.placement>e.placement});for(var i=0;i<e.length;i++)e[i].placement>=t.placement&&1==e[i].voted&&e[i].id!=t.id&&(a.beats.data[e[i].index].placement=i+2);a.refreshTable()}(i)}})},targetEvent:e,validators:{"md-maxlength":4}}).then(function(t){var e=t.getInput();e.$viewChangeListeners.push(function(){e.$setValidity("test","test"!==e.$modelValue)})})},a.editFeedback=function(e,a){e.stopPropagation(),t.small({modelValue:a.feedback,placeholder:"Add feedback",save:function(t){$.ajax({url:"/feedback",data:"beatID="+a.id+"&feedback="+t.$modelValue,type:"post",success:function(t){t.Redirect?window.location.replace(t.RedirectPath):M.toast({html:t.ToastHTML,classes:t.ToastClass,displayLength:1500})}}),battleEntries[a.index].feedback=t.$modelValue},targetEvent:e,validators:{"md-maxlength":256}}).then(function(t){var e=t.getInput();e.$viewChangeListeners.push(function(){e.$setValidity("test","test"!==e.$modelValue)})})},a.likeBeat=function(t,e){t.stopPropagation(),1==e.user_like?battleEntries[e.index].user_like=0:battleEntries[e.index].user_like=1,$.ajax({url:"/like",data:"beatID="+e.id+"&battleID="+e.battle_id+"&userID="+e.artist.id,type:"post",success:function(t){t.Redirect?window.location.replace(t.RedirectPath):M.toast({html:t.ToastHTML,classes:t.ToastClass,displayLength:1500})}})},a.voteBeat=function(t,e){t.stopPropagation(),console.log(e.artist.id),1==e.user_vote?battleEntries[e.index].user_vote=0:0==e.user_vote&&votesRemaining>0&&(battleEntries[e.index].user_vote=1),$.ajax({url:"/vote",data:"beatID="+e.id+"&battleID="+e.battle_id+"&userID="+e.artist.id,type:"post",success:function(t){t.Redirect?window.location.replace(t.RedirectPath):M.toast({html:t.ToastHTML,classes:t.ToastClass,displayLength:1500}),"successvote"==t.ToastQuery&&(votesRemaining-=1,$(".votes-remaining").html(votesRemaining)),"successdelvote"==t.ToastQuery&&(votesRemaining+=1,$(".votes-remaining").html(votesRemaining))}})},a.disqualifyBeat=function(t,e){t.stopPropagation(),battleEntries[e.index].voted=!e.voted,battleEntries[e.index].placement=999,$.ajax({url:"/disqualify",data:"beatID="+e.id+"&battleID="+e.battle_id,type:"post",success:function(t){t.Redirect?window.location.replace(t.RedirectPath):M.toast({html:t.ToastHTML,classes:t.ToastClass,displayLength:1500}),"disqualified"==t.ToastQuery&&i.attr("style","color: #ff5800"),"requalified"==t.ToastQuery&&i.attr("style","")}})},a.logOrder=function(t){console.log("order: ",t)},a.tableChange=function(){console.log("changed"),onChange()},a.refreshTable=function(){var t=JSON.parse(JSON.stringify(a.beats.data));a.beats.data=[],n(function(){a.beats.data=t},50)}}]),$(document).ready(function(){onChange(),$(".deadline").each(function(t,e){$(this).countdown($(this).attr("deadline"),function(t){$(this).text(t.strftime("%Dd %Hh %Mm %Ss"))})})});