function embed(e){if(embedUrl=e.data("embed"),"soundcloud.com"==getHostnameFromRegex(embedUrl)){console.log("soundcloud");var t=embedUrl.split("/");console.log(t),embedData="<iframe height='20' scrolling='no' frameborder='no' allow='autoplay' src='https://w.soundcloud.com/player/?url=",t.length>=6&&(embedUrl="https://soundcloud.com/"+t[3]+"/"+t[4]+"?secret_token="+t[5]),embedData+=embedUrl,embedData+="&color=%23ff5500&inverse=true&auto_play=true&show_user=false'></iframe>",e.closest(".embedded-track").html(embedData)}else getHostnameFromRegex(embedUrl)}const getHostnameFromRegex=e=>{const t=e.match(/^https?\:\/\/([^\/?#]+)(?:[\/?#]|$)/i);return t&&t[1]};function onChange(){$(".tooltipped").tooltip(),$(".playButton").click(function(){embed($(this))})}angular.module("BeatBattle",["ngMaterial","md.data.table"]).config(["$mdThemingProvider",function(e){"use strict";e.theme("default")}]).controller("BeatBattleController",["$mdEditDialog","$q","$scope","$timeout",function(e,t,a,o){"use strict";a.drawTable=!0,a.selected=[],a.limitOptions=[10,25,100],a.query={order:"name",limit:10,page:1},a.beats={count:battleEntries.length,data:battleEntries},a.toggleLimitOptions=function(){a.limitOptions=a.limitOptions?void 0:[10,25,100]},a.editPlacement=function(t,o){t.stopPropagation(),e.small({modelValue:o.placement,save:function(e){o.placement=parseInt(e.$modelValue),$.ajax({url:"/placement",data:"battleID="+o.battle_id+"&beatID="+o.id+"&placement="+o.placement,type:"post",success:function(e){e.Redirect?window.location.replace(e.RedirectPath):M.toast({html:e.ToastHTML,classes:e.ToastClass,displayLength:1500}),"placement"==e.ToastQuery&&function(e){var t=JSON.parse(JSON.stringify(a.beats.data));t.splice(e.index,1),t.splice(e.placement-1,0,e);for(var o=0;o<t.length;o++)1==t[o].voted&&(a.beats.data[t[o].index].placement=o+1);a.refreshTable()}(o)}})},targetEvent:t,validators:{"md-maxlength":4}}).then(function(e){var t=e.getInput();t.$viewChangeListeners.push(function(){t.$setValidity("test","test"!==t.$modelValue)})})},a.editFeedback=function(t,a){t.stopPropagation(),e.small({modelValue:a.feedback,placeholder:"Add feedback",save:function(e){$.ajax({url:"/feedback",data:"beatID="+a.id+"&feedback="+e.$modelValue,type:"post",success:function(e){e.Redirect?window.location.replace(e.RedirectPath):M.toast({html:e.ToastHTML,classes:e.ToastClass,displayLength:1500})}}),battleEntries[a.index].feedback=e.$modelValue},targetEvent:t,validators:{"md-maxlength":256}}).then(function(e){var t=e.getInput();t.$viewChangeListeners.push(function(){t.$setValidity("test","test"!==t.$modelValue)})})},a.likeBeat=function(e,t){e.stopPropagation(),1==t.user_like?battleEntries[t.index].user_like=0:battleEntries[t.index].user_like=1,$.ajax({url:"/like",data:"beatID="+t.id+"&battleID="+t.battle_id+"&userID="+t.artist.id,type:"post",success:function(e){e.Redirect?window.location.replace(e.RedirectPath):M.toast({html:e.ToastHTML,classes:e.ToastClass,displayLength:1500})}})},a.voteBeat=function(e,t){e.stopPropagation(),console.log(t.artist.id),1==t.user_vote?battleEntries[t.index].user_vote=0:0==t.user_vote&&votesRemaining>0&&(battleEntries[t.index].user_vote=1),$.ajax({url:"/vote",data:"beatID="+t.id+"&battleID="+t.battle_id+"&userID="+t.artist.id,type:"post",success:function(e){e.Redirect?window.location.replace(e.RedirectPath):M.toast({html:e.ToastHTML,classes:e.ToastClass,displayLength:1500}),"successvote"==e.ToastQuery&&(votesRemaining-=1,$(".votes-remaining").html(votesRemaining)),"successdelvote"==e.ToastQuery&&(votesRemaining+=1,$(".votes-remaining").html(votesRemaining))}})},a.disqualifyBeat=function(e,t){e.stopPropagation(),battleEntries[t.index].voted=!t.voted,battleEntries[t.index].placement=999,$.ajax({url:"/disqualify",data:"beatID="+t.id+"&battleID="+t.battle_id,type:"post",success:function(e){e.Redirect?window.location.replace(e.RedirectPath):M.toast({html:e.ToastHTML,classes:e.ToastClass,displayLength:1500}),"disqualified"==e.ToastQuery&&i.attr("style","color: #ff5800"),"requalified"==e.ToastQuery&&i.attr("style","")}})},a.logOrder=function(e){console.log("order: ",e)},a.tableChange=function(){console.log("changed"),onChange()},a.refreshTable=function(){var e=JSON.parse(JSON.stringify(a.beats.data));a.beats.data=[],o(function(){a.beats.data=e},50)}}]),$(document).ready(function(){onChange(),$(".deadline").each(function(e,t){$(this).countdown($(this).attr("deadline"),function(e){$(this).text(e.strftime("%Dd %Hh %Mm %Ss"))})})});